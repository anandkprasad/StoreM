<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Flipbook</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.13.216/pdf.min.js"></script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script>

  <style>
    body { margin:0; background:#111; }
    #flipbook { width:90vw; height:90vh; margin: auto; }
    img { width:100%; height:100%; object-fit:contain; }
  </style>
</head>
<body>

<div id="flipbook"></div>

<script>
const pdfUrl = "<%= pdfUrl %>";

async function loadFlipbook() {
  const pdf = await pdfjsLib.getDocument(pdfUrl).promise;

  const flip = document.getElementById("flipbook");

  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({ scale: 1.5 });

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = viewport.width;
    canvas.height = viewport.height;

    await page.render({ canvasContext: ctx, viewport }).promise;

    // Convert canvas â†’ image
    const img = new Image();
    img.src = canvas.toDataURL("image/jpeg", 0.95);

    const div = document.createElement("div");
    div.appendChild(img);
    flip.appendChild(div);
  }

  // Init flipbook after images loaded
  $("#flipbook").turn({
    autoCenter: true
  });
}

loadFlipbook();
</script>

</body>
</html>
