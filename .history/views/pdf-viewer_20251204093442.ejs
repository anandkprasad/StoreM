<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Secure Viewer</title>

  <style>
    :root {
      --bg: #0f1724;
      --toolbar-bg: #071020;
      --muted: #9aa7b2;
    }

    html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Inter,Segoe UI,Helvetica,Arial,sans-serif}
    .toolbar {
      height:56px;
      display:flex;
      align-items:center;
      gap:12px;
      padding:8px 14px;
      background: linear-gradient(180deg, rgba(7,16,32,0.96), rgba(7,16,32,0.9));
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      position:fixed;
      top:0;left:0;right:0;z-index:50;
    }
    .brand { font-weight:600; font-size:16px; }
    .spacer { flex:1 }
    .btn {
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:var(--muted);
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
    }
    .btn.primary { background:#0ea5a4; color:#042022; border:none; }
    .viewer-wrap { position:absolute; top:56px; left:0; right:0; bottom:0; }
    iframe.pdf-frame {
      width:100%;
      height:100%;
      border:0;
      background:#fff;
      /* avoid overflow UI */
    }

    /* Hide UI when printing */
    @media print {
      body * { display: none !important; }
    }

    /* Prevent user selection/copy */
    .no-select, .no-select * {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    /* minimal loading indicator */
    .loader {
      position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:60;
      background: rgba(0,0,0,0.6); padding:12px 16px; border-radius:10px; font-size:14px;
      display:flex; align-items:center; gap:8px;
    }
    .dot { width:8px; height:8px; border-radius:50%; background:#0ea5a4; animation:blink 1s infinite; }
    @keyframes blink { 0%{opacity:0.2} 50%{opacity:1} 100%{opacity:0.2} }
  </style>
</head>
<body class="no-select" oncontextmenu="return false;">

  <div class="toolbar" id="toolbar">
    <div class="brand">StoreM Reader</div>
    <div style="font-size:13px;color:var(--muted)">Secure Preview</div>
    <div class="spacer"></div>

    <!-- Controls (kept minimal) -->
    <button class="btn" id="backBtn" title="Back to dashboard">Back</button>
    <button class="btn" id="openNew" title="Open in new tab">Open</button>
    <button class="btn primary" id="fullscreenBtn" title="Toggle fullscreen">Fullscreen</button>
  </div>

  <div class="viewer-wrap" id="viewerWrap">
    <!-- iframe to load PDF. Replace {{PDF_URL}} with your dynamic url (or use EJS: <%= presignedPdfUrl %>) -->
    <iframe id="pdfFrame" class="pdf-frame" src="{{PDF_URL}}" sandbox="allow-same-origin allow-scripts allow-popups"></iframe>
  </div>

  <div class="loader" id="loader" style="display:none">
    <div class="dot"></div>
    <div>Loading documentâ€¦</div>
  </div>

  <script>
    (function () {
      const pdfUrl = "{{PDF_URL}}"; // replace in server/template
      const backBtn = document.getElementById('backBtn');
      const openNew = document.getElementById('openNew');
      const fullscreenBtn = document.getElementById('fullscreenBtn');
      const pdfFrame = document.getElementById('pdfFrame');
      const loader = document.getElementById('loader');

      // show loader while iframe loads
      loader.style.display = 'flex';
      pdfFrame.addEventListener('load', () => {
        loader.style.display = 'none';
      });

      backBtn.addEventListener('click', () => { window.location.href = '/dashboard'; });

      openNew.addEventListener('click', (e) => {
        // open in new tab (explicit user action)
        window.open(pdfUrl, '_blank', 'noopener,noreferrer');
      });

      fullscreenBtn.addEventListener('click', async () => {
        const el = document.documentElement;
        if (!document.fullscreenElement) {
          await el.requestFullscreen().catch(()=>{});
        } else {
          await document.exitFullscreen().catch(()=>{});
        }
      });

      // Disable context menu (general)
      document.addEventListener('contextmenu', function (e) {
        e.preventDefault();
      }, { passive: false });

      // Block selection/copy/drag
      ['copy','cut','paste','dragstart','selectstart'].forEach(evt => {
        document.addEventListener(evt, function (e) {
          e.preventDefault();
        }, { passive: false });
      });

      // Block common key combos: Ctrl/Cmd+S, Ctrl/Cmd+P, Ctrl/Cmd+U, Ctrl+Shift+I / J, F12
      document.addEventListener('keydown', function (e) {
        // normalize
        const key = e.key.toLowerCase();
        const ctrl = e.ctrlKey || e.metaKey; // metaKey for mac cmd
        const shift = e.shiftKey;

        // combos to block
        if (ctrl && (key === 's' || key === 'p' || key === 'u')) {
          e.preventDefault();
          showTemporaryMessage('Shortcut disabled');
          return;
        }
        // block devtools combos
        if ((ctrl && shift && (key === 'i' || key === 'j')) || (e.key === 'F12')) {
          e.preventDefault();
          showTemporaryMessage('Shortcut disabled');
          return;
        }
      }, { passive: false });

      // show a tiny toast message
      let toastTimer;
      function showTemporaryMessage(msg) {
        const el = document.createElement('div');
        el.textContent = msg;
        Object.assign(el.style, {
          position: 'fixed',
          bottom: '20px',
          left: '50%',
          transform: 'translateX(-50%)',
          background: 'rgba(0,0,0,0.6)',
          color: '#fff',
          padding: '8px 12px',
          borderRadius: '8px',
          zIndex: 9999,
          fontSize: '13px'
        });
        document.body.appendChild(el);
        clearTimeout(toastTimer);
        toastTimer = setTimeout(()=> el.remove(), 1600);
      }

      // Extra: prevent drag-and-drop files onto page (safe)
      window.addEventListener('dragover', function(e){ e.preventDefault(); }, { passive: false });
      window.addEventListener('drop', function(e){ e.preventDefault(); }, { passive: false });

      // If you want to hide the toolbar after a few seconds for cleaner reading:
      let hideToolbarTimer;
      function scheduleHideToolbar() {
        clearTimeout(hideToolbarTimer);
        hideToolbarTimer = setTimeout(() => {
          document.getElementById('toolbar').style.transform = 'translateY(-100%)';
          document.getElementById('toolbar').style.transition = 'transform 250ms ease';
        }, 3000);
      }
      // reveal on mousemove
      document.addEventListener('mousemove', () => {
        const tb = document.getElementById('toolbar');
        tb.style.transform = 'translateY(0)';
        clearTimeout(hideToolbarTimer);
        scheduleHideToolbar();
      });
      scheduleHideToolbar();

      // NOTE: You cannot intercept right-clicks or key presses *inside* the embedded PDF iframe when it is served cross-origin.
      // This UI hardening is best-effort and cosmetic. For traceability and leak-deterrence, use watermarking server-side.

    })();
  </script>
</body>
</html>
