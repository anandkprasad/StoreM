<%- include('./partials/header') %>

<style>
  /* Admin form specific styles */
  body { 
    background:#f8f9fa; 
  }

  .card-admin { 
    border-radius:14px; 
    box-shadow:0 6px 20px rgba(10,20,40,0.04); 
    overflow:hidden; 
    background:#fff; 
  }
  
  .form-header { 
    margin-bottom: 30px; 
    text-align: center; 
  }
  .form-header h1 { 
    margin-bottom: 10px; 
  }
  
  .form-group label { 
    font-weight: 500; 
  }
  
  .preview-image { 
    max-width: 100%; 
    height: auto; 
    margin-top: 10px; 
    border-radius: 4px; 
    max-height: 300px; 
  }
  
  .btn-group-custom { 
    display: flex; 
    gap: 10px; 
    margin-top: 20px; 
  }
  .btn-group-custom button, 
  .btn-group-custom a { 
    flex: 1; 
  }

  @media (max-width: 991px) {
    .form-header h1 { 
      font-size: 1.3rem; 
    }
    .card-admin { 
      padding: 10px; 
    }
  }
</style>

<!-- Admin Form Content -->
<div class="card-admin p-4 mb-4">
  <div class="form-header">
    <h1><%= action === 'add' ? 'Add New Item' : 'Edit Item' %></h1>
    <p class="text-muted">Fill in the details below</p>
  </div>
  
  <form method="POST" enctype="multipart/form-data">
    <div class="form-group">
      <label for="name">Item Name *</label>
      <input type="text" class="form-control" id="name" name="name" value="<%= item?.name || '' %>" required>
    </div>

    <div class="form-group">
      <label for="description">Description *</label>
      <textarea class="form-control" id="description" name="description" rows="4" required><%= item?.description || '' %></textarea>
    </div>

    <div class="form-group">
      <label for="price">Price (â‚¹) *</label>
      <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" value="<%= item?.price || '' %>" required>
    </div>

    <div class="form-group">
      <label for="image">Product Image</label>
      <input type="file" class="form-control" id="image" name="image" accept="image/*" onchange="previewImage(this)">
      <small class="form-text text-muted">Supported formats: JPG, PNG, GIF. Max size: 5MB</small>
      
      <% if (item && item.image_url) { %>
        <div style="margin-top: 15px;">
          <p><strong>Current Image:</strong></p>
          <img src="<%= item.image_url %>" alt="<%= item.name %>" class="preview-image">
        </div>
      <% } %>
      
      <div id="preview-container"></div>
    </div>

    <div class="form-group">
      <label for="pdf">PDF File *</label>
      <input type="file" class="form-control" id="pdf" name="pdf" accept=".pdf" required>
      <small class="form-text text-muted">Upload PDF file for the product. Max size: 50MB</small>
      
      <% if (item && item.pdf_url) { %>
        <div style="margin-top: 15px;">
          <p><strong>Current PDF:</strong> Uploaded (<%= item.page_images ? item.page_images.length : 0 %> pages converted)</p>
        </div>
      <% } %>
    </div>

    <div class="btn-group-custom">
      <a href="/admin" class="btn btn-secondary">Cancel</a>
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-save"></i> <%= action === 'add' ? 'Add Item' : 'Update Item' %>
      </button>
    </div>
  </form>
</div>

<script>
  function previewImage(input) {
    const preview = document.getElementById('preview-container');
    preview.innerHTML = '';
    
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'preview-image';
        img.style.marginTop = '15px';
        
        const p = document.createElement('p');
        p.innerHTML = '<strong>New Image Preview:</strong>';
        
        preview.appendChild(p);
        preview.appendChild(img);
      };
      reader.readAsDataURL(input.files[0]);
    }
  }
</script>

<%- include('./partials/footer') %>