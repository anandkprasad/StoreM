<%- include('header') %>

<style>
  /* Amazon-style product list (search results) */
  .search-hero { 
    padding: 28px 0 8px 0; 
    background: linear-gradient(180deg,#f8f9fb,#ffffff); 
  }
  .amazon-cards { 
    background: transparent; 
  }
  .amazon-cards .product-row { 
    padding: 14px 0; 
    border-bottom: 1px solid rgba(0,0,0,0.06); 
  }
  .amazon-cards .product-card { 
    display:flex; 
    gap:20px; 
    align-items:flex-start; 
    width:100%; 
  }
  .amazon-cards .product-thumb { 
    width:160px; 
    min-width:160px; 
    height:160px; 
    background:#fff; 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    border-radius:8px; 
    box-shadow:0 6px 18px rgba(10,20,40,0.04); 
    overflow:hidden; 
  }
  .amazon-cards .product-thumb img { 
    width:100%; 
    height:100%; 
    object-fit:cover; 
  }
  .amazon-cards .product-info { 
    flex:1; 
    min-width:0; 
  }
  .amazon-cards h5 { 
    margin:0 0 6px 0; 
    font-size:1.02rem; 
    font-weight:600; 
    line-height:1.25; 
    color:#212529; 
  }
  .amazon-cards .byline { 
    font-size:0.9rem; 
    color:#6c757d; 
    margin-bottom:8px; 
    display:block; 
  }
  .amazon-cards .desc { 
    color:#495057; 
    font-size:0.95rem; 
    margin-bottom:10px; 
    display:block; 
    max-height:3.1rem; 
    overflow:hidden; 
    text-overflow:ellipsis; 
  }
  .amazon-cards .meta { 
    display:flex; 
    align-items:center; 
    gap:12px; 
    font-size:0.9rem; 
    color:#6c757d; 
    margin-bottom:8px; 
  }
  .amazon-cards .price-wrap { 
    display:flex; 
    align-items:baseline; 
    gap:10px; 
    margin-bottom:6px; 
  }
  .amazon-cards .price { 
    font-size:1.18rem; 
    font-weight:700; 
    color:#111; 
  }
  .amazon-cards .price-old { 
    text-decoration:line-through; 
    color:#9aa0a6; 
    font-size:0.95rem; 
  }
  .amazon-cards .prime-badge { 
    background:#232f3e; 
    color:#fff; 
    padding:4px 8px; 
    border-radius:4px; 
    font-size:0.82rem; 
    font-weight:700; 
  }
  .amazon-cards .actions { 
    display:flex; 
    align-items:center; 
    gap:10px; 
    margin-left:auto; 
  }
  .badge-tag { 
    background:#eef2ff; 
    color:#27377b; 
    font-weight:700; 
    padding:6px 8px; 
    border-radius:8px; 
    font-size:.82rem; 
  }

  @media (max-width: 991px) {
    .amazon-cards .product-card { 
      flex-direction:column; 
      align-items:center; 
      text-align:center; 
    }
    .amazon-cards .product-thumb { 
      width:220px; 
      min-width:220px; 
      height:220px; 
      margin-bottom:12px; 
    }
    .amazon-cards .actions { 
      width:100%; 
      justify-content:center; 
      margin-top:8px; 
    }
  }

  /* Recommended grid */
  .shop-grid-grid .card { 
    border-radius:14px; 
    overflow:hidden; 
    transition:transform .18s ease, box-shadow .18s ease; 
  }
  .shop-grid-grid .card:hover { 
    transform:translateY(-6px); 
    box-shadow:0 20px 40px rgba(10,20,40,0.08); 
  }
  .shop-grid-grid .product-img-wrap { 
    height:220px; 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    background:linear-gradient(180deg,#fff,#fbfdff); 
  }
  .shop-grid-grid .product-img { 
    width:100%; 
    height:100%; 
    object-fit:cover; 
    border-bottom-left-radius:0; 
    border-bottom-right-radius:0; 
  }
  .shop-grid-grid .card-body { 
    padding:16px; 
  }
  .shop-grid-grid .title { 
    font-size:1rem; 
    font-weight:700; 
    color:#111827; 
    margin-bottom:6px; 
    line-height:1.2; 
    min-height:2.4em; 
  }
  .shop-grid-grid .short-desc { 
    color:#6b7280; 
    font-size:.95rem; 
    min-height:2.6em; 
    overflow:hidden; 
    margin-bottom:10px; 
  }
  .shop-grid-grid .meta-row { 
    display:flex; 
    align-items:center; 
    justify-content:space-between; 
    gap:8px; 
    margin-bottom:10px; 
  }
  .shop-grid-grid .price { 
    font-weight:800; 
    font-size:1.08rem; 
    color:#0f172a; 
  }
  .shop-grid-grid .price-old { 
    text-decoration:line-through; 
    color:#9aa0a6; 
    font-size:.92rem; 
    margin-left:8px; 
  }
  .shop-grid-grid .card-footer { 
    background:transparent; 
    border-top:0; 
    padding:12px 16px; 
    display:flex; 
    align-items:center; 
    gap:8px; 
  }
  .shop-grid-grid .btn-buy { 
    min-width:140px; 
    padding:10px 14px; 
    border-radius:10px; 
    font-weight:700; 
    box-shadow:0 8px 24px rgba(15,40,80,0.06); 
  }
  .shop-grid-grid .rating i { 
    color:#f6b01e; 
    margin-right:2px; 
    font-size:0.92rem; 
  }

  @media (min-width: 992px) {
    .shop-grid-grid .card-footer { 
      justify-content:flex-end; 
    }
  }

  @media (max-width: 991px) {
    .shop-grid-grid .product-img { 
      height:220px; 
      width:100%; 
    }
    .shop-grid-grid .card-footer { 
      flex-direction:column-reverse; 
      align-items:stretch; 
      gap:10px; 
    }
    .shop-grid-grid .btn-buy { 
      width:100%; 
      min-width:0; 
    }
    .shop-grid-grid .title { 
      min-height:3.6em; 
    }
  }

  .no-results { 
    padding:60px 0; 
    color:#6c757d; 
  }
</style>

<!-- Search Results -->
<div class="container search-hero">
  <h2 class="mb-3">Search Results for "<%= query || '' %>"</h2>

  <% if (results && results.length > 0) { %>
    <div class="amazon-cards">
      <% results.forEach(function(item) { %>
        <div class="row product-row">
          <div class="col-12">
            <div class="product-card align-items-start">

              <!-- thumb -->
              <div class="product-thumb" aria-hidden="true">
                <img loading="lazy" src="<%= (item.imageUrl || item.image_url) ? ((item.imageUrl || item.image_url).startsWith('/') ? (item.imageUrl || item.image_url) : (item.imageUrl || item.image_url)) : '/img/default-product.png' %>" alt="<%= item.name %>">
              </div>

              <!-- info -->
              <div class="product-info">
                <h5><a href="/product/<%= item._id %>" class="text-dark" style="text-decoration:none;"><%= item.name %></a></h5>
                <% if (item.author) { %>
                  <span class="byline">by <strong><%= item.author %></strong></span>
                <% } %>

                <div class="desc">
                  <% let words = (item.description || '').split(/\s+/); %>
                  <%= words.slice(0, 36).join(' ') %><%= words.length > 36 ? '...' : '' %>
                </div>

                <div class="meta">
                  <% if (item.category) { %>
                    <span class="badge-tag"><%= item.category %></span>
                  <% } %>
                  <% if (item.pages) { %>
                    <span><%= item.pages %> pages</span>
                  <% } %>
                </div>

                <div class="price-wrap">
                  <div class="price">₹ <%= item.price %></div>
                  <% if (item.original_price && item.original_price > item.price) { %>
                    <div class="price-old">₹ <%= item.original_price %></div>
                  <% } %>
                  <% if (item.isPrime) { %>
                    <div style="margin-left:12px;">
                      <span class="prime-badge">PRIME</span>
                    </div>
                  <% } %>
                </div>
              </div>

              <!-- actions -->
              <div class="actions d-flex">
                <div class="ml-auto d-none d-md-block">
                  <a href="/product/<%= item._id %>" class="btn btn-primary btn-sm btn-buy" aria-label="View <%= item.name %>">
                    <i class="fas fa-shopping-cart mr-1"></i>Buy Now
                  </a>
                </div>

                <div class="d-block d-md-none w-100 mt-2">
                  <a href="/product/<%= item._id %>" class="btn btn-primary btn-block">
                    <i class="fas fa-shopping-cart mr-1"></i>Buy Now
                  </a>
                </div>
              </div>

            </div>
          </div>
        </div>
      <% }); %>
    </div>
  <% } else { %>
    <div class="no-results text-center">
      <h4>No results found for "<%= query || '' %>"</h4>
      <p class="small">Try different keywords, or browse our recommended ebooks below.</p>
    </div>
  <% } %>
</div>

<!-- Recommended -->
<div class="container mt-5">
  <h3 class="mb-4">Recommended for you</h3>
  <div class="row px-xl-5 pb-3 shop-grid-grid">
    <% (recommended && recommended.length ? recommended : featuredItems || []).forEach(function(item) { %>
      <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex align-items-stretch">
        <div class="card w-100 d-flex flex-column">

          <!-- image -->
          <div class="product-img-wrap">
            <img loading="lazy" class="product-img" src="<%= item.image_url || item.imageUrl || '/img/product-1.jpg' %>" alt="<%= item.name %>">
          </div>

          <!-- body -->
          <div class="card-body d-flex flex-column">
            <a href="/product/<%= item._id %>" style="text-decoration:none;">
              <div class="title"><%= item.name %></div>
            </a>

            <% if (item.author) { %>
              <div class="mb-1" style="color:#6b7280;font-size:.92rem;">by <strong><%= item.author %></strong></div>
            <% } %>

            <div class="short-desc">
              <% let words = (item.description || '').split(/\s+/); %>
              <%= words.slice(0, 28).join(' ') %><%= words.length > 28 ? '...' : '' %>
            </div>

            <div class="meta-row mt-auto">
              <div class="d-flex align-items-center">
                <% if (item.rating) { %>
                  <div class="rating">
                    <% for (var i=0;i<5;i++){ %>
                      <i class="fa fa-star<%= i < Math.round(item.rating) ? '' : '-o' %>"></i>
                    <% } %>
                    <small class="ml-2 text-muted"><%= item.rating %></small>
                  </div>
                <% } %>
              </div>

              <div class="text-right">
                <div class="price">₹ <%= item.price %>
                  <% if (item.original_price && item.original_price > item.price) { %>
                    <span class="price-old">₹ <%= item.original_price %></span>
                  <% } %>
                </div>
              </div>
            </div>
          </div>

          <!-- footer actions -->
          <div class="card-footer">
            <a href="/product/<%= item._id %>" class="btn btn-primary btn-buy ml-auto" role="button" aria-label="Buy <%= item.name %> now">
              <i class="fas fa-shopping-cart mr-2"></i>BUY NOW
            </a>
          </div>
        </div>
      </div>
    <% }); %>
  </div>
</div>

<%- include('footer') %>