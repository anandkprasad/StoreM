// server.js
// npm init -y && npm i express node-fetch
const express = require('express');
const fetch = require('node-fetch'); // if using Node 18+, you can use global fetch
const app = express();

// Basic auth middleware placeholder â€” add real auth in production!
function requireAuth(req, res, next) {
  // e.g., check session or API key
  // For testing you can skip this, but DO NOT expose in production.
  next();
}

app.get('/pdf-proxy', requireAuth, async (req, res) => {
  const url = req.query.url;
  if (!url) return res.status(400).send('missing url param');
  // OPTIONAL: validate that url is only allowed host(s)
  try {
    const upstream = await fetch(url);
    if (!upstream.ok) return res.status(upstream.status).send('upstream error');
    // Copy relevant headers
    const contentType = upstream.headers.get('content-type') || 'application/pdf';
    res.set('Content-Type', contentType);
    res.set('Cache-Control', 'no-store');
    // stream directly
    upstream.body.pipe(res);
  } catch (err) {
    console.error('proxy error', err);
    res.status(500).send('proxy error');
  }
});

app.use(express.static('public')); // serve the fixed HTML from ./public

app.listen(3000, () => console.log('Server listening on http://localhost:3000'));
