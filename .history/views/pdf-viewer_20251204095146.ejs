<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PDF Viewer — iframe (interactive, fullscreen, toolbar mask)</title>

<script>
  // === CONFIG ===
  const IFRAME_SRC = "https://www.dropbox.com/scl/fi/fraizb3xwx6jcmd9307xq/693101df095ae9fd19fea697.pdf?rlkey=38p2ukkfqlrfcwfiv7itk4vob&raw=1";
  const WATERMARK_BASE = "Purchased by: user@example.com — order #12345";
  // If true, a visual mask will cover the top-right area where Dropbox shows download buttons.
  // This is a crude but effective visual block; adjust mask width/height as needed for different screens.
  const COVER_TOOLBAR = true;
  // === end config ===
</script>

<style>
  :root{
    --bg: #000;
    --wm-opacity: 0.08;
    --wm-size: 18px;
  }
  html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#fff}
  #app{position:fixed;inset:0;display:flex;flex-direction:column;align-items:stretch;justify-content:center;background:#000}
  #frameWrap{position:relative;flex:1;display:block;overflow:hidden;background:#000}
  iframe#pdfFrame{
    position:absolute; inset:0; border:0; width:100%; height:100%;
    background:#111;
    /* allow interaction (scroll/zoom) */
    pointer-events: auto;
  }

  /* watermark overlay (on top of iframe) */
  #watermark{position:absolute;inset:0;z-index:40;pointer-events:none;overflow:hidden}
  .wmText{position:absolute;transform:rotate(-30deg);opacity:var(--wm-opacity);white-space:nowrap;user-select:none;font-size:var(--wm-size);color:rgba(255,255,255,0.95)}
  
  /* message + controls */
  #topControls { position:absolute; left:12px; top:12px; z-index:60; display:flex; gap:8px; align-items:center; }
  button.ctrl { background:rgba(0,0,0,0.6); color:#fff; border:1px solid rgba(255,255,255,0.06); padding:8px 10px; border-radius:6px; cursor:pointer; font-size:13px; }
  #message { position:absolute; left:12px; bottom:12px; z-index:60; background:rgba(0,0,0,0.45); padding:8px 10px; border-radius:6px; font-size:13px; color:#eee; }

  /* top-right mask to hide toolbar */
  #toolbarMask {
    position:absolute;
    top:0;
    right:0;
    z-index:45;
    background:linear-gradient(90deg, rgba(0,0,0,0.95), rgba(0,0,0,0.45));
    pointer-events:auto; /* captures clicks so toolbar isn't clickable */
    /* default size - tweak if necessary */
    width:220px;
    height:70px;
    border-bottom-left-radius:8px;
  }

  /* when in fullscreen, mask may need resizing */
  :fullscreen #toolbarMask, :-webkit-full-screen #toolbarMask { width:260px; height:80px; }

  /* global defensive handlers (hide scrollbars) */
  ::-webkit-scrollbar { width:0; height:0; }
</style>
</head>
<body>
<div id="app" role="application" aria-label="PDF viewer">
  <div id="frameWrap">
    <iframe id="pdfFrame" src="" title="PDF viewer"></iframe>

    <!-- optional mask to hide the top-right toolbar of Dropbox viewer -->
    <div id="toolbarMask" style="display:none;"></div>

    <!-- watermark overlay -->
    <div id="watermark" aria-hidden="true"></div>

    <!-- controls -->
    <div id="topControls">
      <button id="fsBtn" class="ctrl">Enter Fullscreen</button>
      <button id="toggleMask" class="ctrl">Hide Toolbar</button>
      <button id="openTab" class="ctrl">Open in New Tab</button>
    </div>

    <div id="message">Double-click top-left to toggle controls. Use Fullscreen to view the PDF full-screen.</div>
  </div>
</div>

<script>
  const frame = document.getElementById('pdfFrame');
  const toolbarMask = document.getElementById('toolbarMask');
  const watermark = document.getElementById('watermark');
  const message = document.getElementById('message');
  const fsBtn = document.getElementById('fsBtn');
  const toggleMaskBtn = document.getElementById('toggleMask');
  const openTabBtn = document.getElementById('openTab');
  const topControls = document.getElementById('topControls');

  // load iframe
  frame.src = IFRAME_SRC;

  // watermark grid builder
  function buildWatermark(text) {
    watermark.innerHTML = '';
    const w = window.innerWidth;
    const h = window.innerHeight;
    const stepX = Math.max(240, Math.floor(w / 4.5));
    const stepY = Math.max(140, Math.floor(h / 6));
    for (let y = -stepY; y < h + stepY; y += stepY) {
      for (let x = -stepX; x < w + stepX; x += stepX) {
        const d = document.createElement('div');
        d.className = 'wmText';
        d.style.left = `${x}px`;
        d.style.top = `${y}px`;
        d.style.fontSize = Math.max(12, Math.floor(Math.min(w,h)/50)) + 'px';
        d.textContent = `${WATERMARK_BASE} — ${new Date().toLocaleString()}`;
        watermark.appendChild(d);
      }
    }
  }
  buildWatermark();
  setInterval(()=> buildWatermark(), 30_000);

  // Fullscreen (needs user gesture)
  async function enterFullscreen() {
    try {
      if (!document.fullscreenElement) {
        await document.documentElement.requestFullscreen({navigationUI: "hide"});
      } else {
        await document.exitFullscreen();
      }
    } catch (e) {
      console.warn('Fullscreen failed', e);
    }
  }
  fsBtn.addEventListener('click', enterFullscreen);

  // Toggle toolbar mask
  let maskOn = COVER_TOOLBAR;
  function applyMask() {
    toolbarMask.style.display = maskOn ? 'block' : 'none';
    toggleMaskBtn.textContent = maskOn ? 'Unhide Toolbar' : 'Hide Toolbar';
  }
  maskOn = COVER_TOOLBAR;
  applyMask();
  toggleMaskBtn.addEventListener('click', () => { maskOn = !maskOn; applyMask(); });

  // Open in new tab (safe)
  openTabBtn.addEventListener('click', () => {
    window.open(IFRAME_SRC, '_blank', 'noopener,noreferrer');
  });

  // Double-click top-left to toggle controls visible
  let controlsVisible = true;
  document.addEventListener('dblclick', (e) => {
    // only when double-click is near top-left (prevent accidental toggles)
    if (e.clientX < window.innerWidth * 0.4 && e.clientY < window.innerHeight * 0.3) {
      controlsVisible = !controlsVisible;
      topControls.style.display = controlsVisible ? 'flex' : 'none';
    }
  });

  // Block context menu + block common save/print keys
  document.addEventListener('contextmenu', e => e.preventDefault(), {capture:true});
  window.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && ['s','p','u','S','U'].includes(e.key)) { e.preventDefault(); e.stopPropagation(); }
    if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && ['I','C','J'].includes(e.key.toUpperCase()))) {
      e.preventDefault(); e.stopPropagation();
    }
  }, {capture:true});

  // Prevent drag/select copy outside the iframe (best-effort)
  ['selectstart','dragstart','copy','cut','paste'].forEach(evt => {
    document.addEventListener(evt, e => e.preventDefault(), {capture:true});
  });

  // If user scrolls the page, allow scrolling inside iframe by focusing it:
  frame.addEventListener('load', () => {
    try { frame.contentWindow.focus(); } catch (e) { /* cross-origin - ignore */ }
    message.style.display = 'none';
  });

  // Try focusing iframe on user interaction to ensure scroll/zoom works without clicking toolbar
  document.addEventListener('click', (e) => {
    // If click in the central area, focus the iframe by bringing it to front (can't access cross-origin focus reliably)
    // This is best-effort; scrolling usually works by default when pointer-events are auto.
    try { frame.contentWindow.focus(); } catch (err) {}
  }, {passive:true});

  // Adjust mask size responsively (optional: tweak if toolbar moves)
  function adjustMask() {
    // Example sizes tuned for desktop Dropbox UI; adjust if you see leftover visible buttons
    const width = Math.max(160, Math.floor(window.innerWidth * 0.18));
    const height = Math.max(60, Math.floor(window.innerHeight * 0.08));
    toolbarMask.style.width = width + 'px';
    toolbarMask.style.height = height + 'px';
  }
  window.addEventListener('resize', adjustMask);
  adjustMask();

  // Note to console
  console.info('Interactive iframe viewer loaded. Masking toolbar =', maskOn, '. Fullscreen requires a click of the button.');
</script>
</body>
</html>
